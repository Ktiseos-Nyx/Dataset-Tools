{
  "parser_name": "FORENSIC_ANALYSIS_TOOL",
  "priority": 999,
  "description": "TEMPORARY DIAGNOSTIC TOOL to inspect raw metadata sources.",
  "target_file_types": ["PNG", "JPG", "JPEG", "WEBP"],

  "detection_rules": [
    {
      "comment": "Rule 1: Just needs to be a ComfyUI workflow somewhere.",
      "condition": "OR",
      "rules": [
        { "source_type": "pil_info_key", "source_key": "workflow", "operator": "is_valid_json" },
        { "source_type": "pil_info_key", "source_key": "prompt", "operator": "is_valid_json" },
        { "source_type": "exif_user_comment", "operator": "is_valid_json" }
      ]
    }
  ],

  "parsing_instructions": {
    "fields": [
      {
        "target_key": "source_pil_info_workflow",
        "method": "direct_context_value",
        "context_key": "pil_info.workflow"
      },
      {
        "target_key": "source_pil_info_prompt",
        "method": "direct_context_value",
        "context_key": "pil_info.prompt"
      },
      {
        "target_key": "source_exif_user_comment",
        "method": "direct_context_value",
        "context_key": "raw_user_comment_str"
      }
    ],
    "output_template": {
      "tool": "FORENSIC ANALYSIS",
      "parser_version": "diagnostic_v1",
      "instruction": "Find which source below contains your workflow JSON. That is the source_type you must use in your detection rules.",
      "analysis": {
        "pil_info_workflow_found": "$source_pil_info_workflow",
        "pil_info_prompt_found": "$source_pil_info_prompt",
        "exif_user_comment_found": "$source_exif_user_comment"
      }
    }
  }
}
